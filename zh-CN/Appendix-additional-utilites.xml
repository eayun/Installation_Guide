<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Installation_Guide.ent">
%BOOK_ENTITIES;
]>
<appendix id="appe-Installation_Guide-appendix-additional-utilites_Chapter">
	<title>管理员实用工具箱</title>
    <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1">
        <title>&OVIRT;域管理工具</title>
        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_1">
            <title>关于&OVIRT;域管理工具</title>
            <para>&OVIRT;虚拟化环境使用目录服务对于用户进行管理和验证。要在
                &OVIRT;虚拟化环境中添加用户，首先通过admin@internal用户为
                &MANAGER;配置目录服务。添加、删除目录服务时使用
                engine-manage-domains命令。
            </para>
            <para>只有&OVIRT;&MANAGER;服务器上安装了engine-manage-domains命令，
                该命令必须由root用户执行。
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_2">
            <title>&OVIRT;域管理工具的命令行说明</title>
            <para>命令的使用方法如下：
                <synopsis>
                    engine-manage-domains -action=ACTION [options]
                </synopsis>
                可用的操作（ACTION）有：
                <variablelist>
                    <varlistentry>
                        <term>add</term>
                        <listitem>
                            <para>为&OVIRT;&MANAGER;添加目录服务。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>edit</term>
                        <listitem>
                            <para>编辑&OVIRT;&MANAGER;中的目录服务。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>delete</term>
                        <listitem>
                            <para>为&OVIRT;&MANAGER;删除目录服务。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>validate</term>
                        <listitem>
                            <para>验证&OVIRT;&MANAGER;中的目录服务。该操作会使用
                                之前配置的用户和密码对所有目录服务进行验证尝试。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>list</term>
                        <listitem>
                            <para>列出&OVIRT;&MANAGER;中的目录服务。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
                其他的命令行选项要配合操作一同使用：
                <variablelist>
                    <varlistentry>
                        <term>-domain=DOMAIN</term>
                        <listitem>
                            <para>制定要进行操作的域。对于add、edit和delete操作
                                -domain是必须指定的。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-provider=PROVIDER</term>
                        <listitem>
                            <para>指定目录服务的类型，支持的目录服务有：
                                <itemizedlist>
                                    <listitem>
                                        <para>ActiveDirectory - Active Directory
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>IPA - Identity Management（IdM）
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>RHDS - Red Hat Directory Service。
                                            RHDS不使用Kerberos，而&OVIRT;虚拟化
                                            环境要求使用Kerberos，因此使用RHDS时
                                            需要配置Kerberos域中的一个目录服务。
                                            <note>
                                                <para>使用RHDS时必须安装memberof
                                                    插件，使用memeberof插件要求
                                                    用户都是inetuser用户。
                                                </para>
                                            </note>
                                        </para>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-user=USER</term>
                        <listitem>
                            <para>指定目录服务的用户。在add操作中-user选项是必需
                                的，edit操作则可以不会指定。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-passwordFile=FILE</term>
                        <listitem>
                            <para>指定密码文件，目录服务用户的密码在该文件的第一
                                行。执行add操作时，-passwordFile或者-interactive
                                选项必须使用其中一个。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-addPermissions</term>
                        <listitem>
                            <para>为指定的域用户赋予在&OVIRT;&MANAGER;中的
                                SuperUser角色。默认的情况下，没有启用这一选项，
                                指定的域用户不会获得SuperUser的角色。在add和edit
                                操作中可以选择使用-addPermissions选项。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-interactive</term>
                        <listitem>
                            <para>指定域用户的密码是否手动（交互式）地提供。在
                                add操作中，该选项和-passwordFile必须选择其中一个
                                使用。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-configFile=FILE</term>
                        <listitem>
                            <para>指定命令配置文件的路径。不使用默认配置文件时，
                                使用该选项。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-report</term>
                        <listitem>
                            <para>该选项和validate操作一起使用时，会生成在验证过
                                程发生的所有错误信息的报告。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </para>
            <para>engine-manage-domains使用方法的完整说明也可以通过下面的命令获
                取：
                <screen># engine-manage-domains --help
                </screen>
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_3">
            <title>使用&OVIRT;域管理工具</title>
            <para>后面几小节通过实际的例子对于&OVIRT;域管理工具的使用方法进行了
                说明。
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_4">
            <title>添加目录服务</title>
            <para>本例中，engine-manage-domains将IdM域demo.eayunos.eayun.com添加
                到&OVIRT;&MANAGER;中。使用的用户是eayunos，密码是手动提供的。
                <example>
                    <title>engine-manage-domains的add操作</title>
<screen>
# engine-manage-domains -action=add -domain=demo.eayunos.eayun.com \
-provider=IPA -user=eayunos -interactive
loaded template kr5.conf file
setting default_tkt_enctypes
setting realms
setting domain realm
success
User guid is: 6d580ef5-130a-4931-bcd0-23bd23028ece
Successfully added domain demo.eayunos.eayun.com. oVirt Engine restart is
required in order for the changes to take place (service ovirt-engine restart).
</screen>
                </example>
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_5">
            <title>修改目录服务</title>
            <para>本例中，engine-manage-domains对IdM域demo.eayunos.eayun.com的配
                置进行了更改。更改完成之后，&OVIRT;&MANAGER;查询目录服务时使用新
                的用户eayunos。命令执行时密码手动提供。
                <example>
                    <title>engine-manage-domains的edit操作</title>
<screen>
# engine-manage-domains -action=edit -domain=demo.eayunos.eayun.com \
-provider=IPA -user=eayunos -interactive
loaded template kr5.conf file
setting default_tkt_enctypes
setting realms
setting domain realm
success
User guid is: 6d580ef5-130a-4931-bcd0-23bd23028ece
Successfully added domain demo.eayunos.eayun.com. oVirt Engine restart is
required in order for the changes to take place (service ovirt-engine restart).
</screen>
                </example>
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_6">
            <title>删除目录服务</title>
            <para>本例中，engine-manage-domains从&OVIRT;&MANAGER;中删除IdM域
                demo.eayunos.eayun.com的配置。更改完成之后，&OVIRT;&MANAGER;中属
                于demo.eayunos.eayun.com的用户将无法登录，但是依然会保留在用户列
                表中，除非手动清理用户列表。
            </para>
            <para>本例中要删除的目录服务是&OVIRT;&MANAGER;中最后一个，所以命令执
                行过程中会给出一个警告，提醒用户最后一个目录服务删除之后，只有
                admin@internal用户可以登录到&MANAGER;，新的用户只能在添加新的目
                录服务之后手动添加。
                <example>
                    <title>engine-manage-domains的delete操作</title>
<screen>
# engine-manage-domains -action=delete -domain=demo.eayunos.eayun.com
WARNING: Domain directory.demo.redhat.com is the last domain in the
configuration. After deleting it you will have to either add another domain, or
to use the internal admin user in order to login.
Successfully deleted domain demo.eayunos.eayun.com. Please remove all users
and groups of this domain using the Administration portal or the API.
</screen>
                </example>
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_7">
            <title>验证目录服务</title>
            <para>本例中，engine-manage-domains对&OVIRT;&MANAGER;中的目录服务进
                行验证。验证方法是根据配置文件中每一个目录服务的验证信息进行登录
                尝试，如果成功登录则说明目录服务可用。
                <example>
                    <title>engine-manage-domains的validate操作</title>
<screen>
# engine-manage-domains -action=validate
Domain eayunos.eayun.com is valid.
The configured user for domain eayunos.eayun.com is eayunos@EAYUNOS.EAYUN.COM
Manage Domains completed successfully
</screen>
                </example>
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_1_8">
            <title>列出所有目录服务</title>
            <para>本例中，engine-manage-domains会列出&OVIRT;&MANAGER;中所有目录
                服务。命令结果会列出域名称，域用户（UPN，User Principal Name格
                式）。
                <example>
                    <title>engine-manage-domains的list操作</title>
<screen>
# engine-manage-domains -action=list
Domain: eayunos.eayun.com
    User name: eayunos@EAYUNOS.EAYUN.COM
    Manage Domains completed successfully
</screen>
                </example>
            </para>
        </section>
    </section>

    <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_2">
        <title>&OVIRT;配置管理工具</title>
        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_2_1">
            <title>关于&OVIRT;配置管理工具</title>
            <para>安装&OVIRT;&MANAGER;时自动对其中一些默认配置进行修改，调整
                &MANAGER;的配置项有专门的配置管理工具：engine-config。
            </para>
            <para>&OVIRT;配置管理工具并不依赖于&MANAGER;是否已经启动，配置项是保
                存在数据库的，因此只需要确保使用配置管理工具时数据库在正常运行。
                修改过的配置项在&MANAGER;重启之后生效。
            </para>
            <para>&OVIRT;&MANAGER;的配置项是一系列的key-value对。配置管理工具可
                以进行以下操作：
                <itemizedlist>
                    <listitem><simpara>
                        列出所有的配置项（key），
                    </simpara></listitem>
                    <listitem><simpara>
                        列出所有的配置项的值（value），
                    </simpara></listitem>
                    <listitem><simpara>
                        获取指定配置项的值，
                    </simpara></listitem>
                    <listitem><simpara>
                        修改指定配置项的值。
                    </simpara></listitem>
                </itemizedlist>
            </para>
            <para>&OVIRT;配置管理工具可以同时多份&MANAGER;的配置。指定配置的版本
                时，执行命令需要加上--cver参数，默认的配置的版本是general。
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_2_2">
            <title>&OVIRT;配置管理工具的命令行说明</title>
            <para>&OVIRT;&MANAGER;服务器上安装了配置管理工具，关于命令的详细说明
                可以执行下面的命令获取：
                <screen># engine-config --help
                </screen>
            </para>
            <simplesect>
                <title>常规操作</title>
                <variablelist>
                    <varlistentry>
                        <term>列出所有的配置项</term>
                        <listitem><para>使用--list选项可以列出所有的配置项
                                <screen># engine-config --list
                                </screen>
                                所有的配置项及其描述都会打印出来。
                        </para></listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>列出所有配置项的值</term>
                        <listitem><para>使用--all选项可以列出所有配置项的值
                                <screen># engine-config --all
                                </screen>
                                所有的配置项、配置项当前值以及配置版本都会打印出
                                来。
                        </para></listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>获取指定配置项的值</term>
                        <listitem><para>使用--get可以获取指定配置项的值
                                <screen># engine-config --get KEY_NAME
                                </screen>
                                将KEY_NAME替换为要查询的配置项。命令会打印出该配
                                置项，配置项当前值以及配置版本。要或者指定配置版
                                本中配置项的值，需要加上--cver选项。
                        </para></listitem>
                    </varlistentry>                    <varlistentry>
                        <term>设置指定配置项的值</term>
                        <listitem><para>使用--set可以设置指定配置项的值，要设置
                                指定配置版本中配置项的值，需要加上--cver选项。
<screen># engine-config --set KEY_NAME=KEY_VALUE --cver=VERSION
</screen>
                                将KEY_NAME替换为要设置的配置项，KEY_VALUE替换为
                                配置项的值，设置其他版本配置中的配置项时将
                                VERSION替换为配置的版本。
                        </para></listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_2_3">
            <title>admin@internal用户</title>
            <para>安装&OVIRT;&MANAGER;时会自动创建admin@internal用户，用户信息保
                存在&MANAGER;自身的数据库中，其他用户则需要从目录服务中添加。和
                外部目录服务的用户域不同，internal域无法增加、删除用户。
                admin@internal用户在&OVIRT;&MANAGER;中拥有SuperUser角色，具有管
                理权限。
            </para>
            <para>admin@internal用户的密码在安装&MANAGER;的过程中设置，修改密码
                需要使用engine-config命令。
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_2_4">
            <title>修改admin@internal用户的密码</title>
            <procedure>
                <step>
                    <para>使用root用户登录到&OVIRT;&MANAGER;服务器。
                    </para>
                </step>
                <step>
                    <para>使用engine-config命令为admin@internal设置新的密码：
                        <screen># engine-config -s AdminPassword=interactive
                        </screen>
                        如果密码中有特殊字符，注意使用转义。
                    </para>
                </step>
                <step>
                    <para>重启&MANAGER;使新的密码生效：
                        <screen># service ovirt-engine restart
                        </screen>
                    </para>
                </step>
            </procedure>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_2_5">
            <title>配置管理工具使用示例</title>
            <example>
                <title>获取配置项的值</title>
<screen># engine-config --get=SearchResultsLimit --cver=general
100
</screen>
            </example>
            <example>
                <title>设置配置项的值</title>
<screen># engine-config --set SearchResultsLimit=50 --cver=general
</screen>
            </example>
        </section>
    </section>

    <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_3">
        <title>&OVIRT;虚拟机镜像上传工具</title>
        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_3_1">
            <title>关于&OVIRT;虚拟机镜像上传工具</title>
            <para>使用engine-image-uploader工具可以查看export存储域的列表，上传
                OVF格式的虚拟机镜像文件到指定export存储域。&OVIRT;&MANAGER;能够
                识别和使用上传的虚拟机镜像。engine-image-uploader目前只支持在
                &OVIRT;&MANAGER;中导出的经过gzip压缩的虚拟机镜像。
            </para>
            <para>使用虚拟机镜像上传工具极大地简化了分发虚拟机镜像的工作。
            </para>
            <para>虚拟机镜像的格式包含以下内容：
                <screen>|-- images
|   |-- [Image Group UUID]
|        |--- [Image UUID (this is the disk image)]
|        |--- [Image UUID (this is the disk image)].meta
|-- master
|   |---vms
|       |--- [UUID]
|             |--- [UUID].ovf
                </screen>
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_3_2">
            <title>&OVIRT;虚拟机镜像上传工具的命令行说明</title>
            <para>engine-image-uploader的基本使用方法如下：
                <screen>engine-image-uploader [options] list
engine-image-uploader [options] upload [file].[file]...[file]
                </screen>
            </para>
            <para>2种操作模式：list和upload。
                <itemizedlist>
                    <listitem>
                        <para>list操作会列出所有可以上传镜像的export存储域。
                        </para>
                    </listitem>
                    <listitem>
                        <para>upload操作将指定的镜像文件上传到指定的存储域。
                        </para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>使用engine-image-uploader时必须指定list或者upload其中一种操
                作。进行upload操作时最少提供一个镜像文件名已进行上传。
            </para>
            <para>其他的命令行参数可以对engine-image-uploader命令进行更精细的控
                制，也可以将一些默认的配置参数写入到配置文件：
                /etc/ovirt-engine/im ageuploader.conf。
            </para>

            <simplesect>
                <title>通用命令行参数</title>
                <variablelist>
                    <varlistentry>
                        <term>-h，--help</term>
                        <listitem>
                            <para>显示命令的帮助信息。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--config-file=配置文件路径</term>
                        <listitem>
                            <para>指定配置文件。默认的配置文件是
                                /etc/ovirt-engine/imageuploader.conf。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--log-file=日志文件路径</term>
                        <listitem>
                            <para>指定命令执行过程中输出内容写入的日志文件。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--quiet</term>
                        <listitem>
                            <para>设置命令执行过程产生最少的输出内容。默认不开启
                                该选项。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--verbose</term>
                        <listitem>
                            <para>设置命令执行过程产生尽可能多的输出内容。默认不
                                开启该选项。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-f，--force</term>
                        <listitem>
                            <para>当目标存储域中已经存在一个和将要上传的文件名字
                                相同，则必须使用强制模式。默认开启该选项。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>&OVIRT;&MANAGER;相关选项</title>
                <variablelist>
                    <varlistentry>
                        <term>-u 用户名，--user=用户名</term>
                        <listitem>
                            <para>上传镜像文件时使用的用户。用户名的格式为：
                                user@domain。同时用户必须在&OVIRT;&MANAGER;中已
                                经存在。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-r FQDN</term>
                        <listitem>
                            <para>指定镜像文件上传的目标&OVIRT;&MANAGER;服务器的
                                FQDN域名。默认是localhost:443，即运行该命令的服
                                务器和&OVIRT;&MANAGER;是同一台服务器。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>Export数据域相关选项</title>
                <para>下面的选项指定镜像文件上传的目标Export存储域，这些选项是互
                    斥的，不能同时使用。
                </para>
                <variablelist>
                    <varlistentry>
                        <term>-e，--export-domain=Export存储域名称</term>
                        <listitem>
                            <para>指定镜像文件上传的目标Export存储域。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-n，-nfs-server=NFS共享目录地址</term>
                        <listitem>
                            <para>指定镜像文件上传的目标NFS共享目录地址。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-i，--ovf-id</term>
                        <listitem>
                            <para>开启该选项之后，镜像文件的UUID不会被修改。默认
                                的情况下，镜像文件上传之后会自动获取一个新的
                                UUID，不会和其他的UUID冲突。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-d，--disk-instance-id</term>
                        <listitem>
                            <para>开启该选项之后，镜像文件中所有磁盘的实例ID不会
                                被修改。默认的情况下，镜像文件上传之后磁盘都会自
                                动获取一个新的UUID防止出现冲突。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-m，--mac-address</term>
                        <listitem>
                            <para>开启该选项之后，镜像文件中的网络组件不会被删
                                除。默认情况下镜像文件上传时其中的网络组件会被删
                                除以防止和其他的网络设备发生冲突。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-N 新镜像文件名，--name=新镜像文件名</term>
                        <listitem>
                            <para>开启该选项之后，镜像文件上传之后会使用新的文件
                                名。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_3_3">
            <title>创建与镜像上传工具兼容的OVF文件</title>
            <simplesect>
                <title>说明：</title>
                <para>创建可以使用engine-image-uploader上传的OVF文件。
                </para>
                <procedure>
                    <title>创建与镜像上传工具兼容的OVF文件</title>
                    <step>
                        <para>在&MANAGER;中创建一个空Export存储域。
                        </para>
                    </step>
                    <step>
                        <para>将虚拟机导出到新创建的Export存储域。
                        </para>
                    </step>
                    <step>
                        <para>登录到Export存储域所在的实际服务器，找到Export存储
                            域对应的NFS共享目录，该目录下应该有2个目录：images和
                            master。
                        </para>
                    </step>
                    <step>
                        <para>执行以下命令：
                            <screen># tar -zcvf my.ovf images/ master/
                            </screen>
                        </para>
                    </step>
                    <step>
                        <para>使用生成的ovf文件即可在&OVIRT;&MANAGER;中恢复虚拟
                            机。
                        </para>
                    </step>
                </procedure>
            </simplesect>
            <simplesect>
                <title>预期结果：</title>
                <para>创建的ovf文件，可以通过engine-image-uploader命令上传到
                    &OVIRT;&MANAGER;进行虚拟机导入。
                </para>
            </simplesect>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_3_4">
            <title>engine-image-uploader使用示例</title>
            <para>下面的示例使用engine-image-uploader列出存储域上传OVF文件：
            </para>
            <example>
                <title>使用engine-image-uploader上传文件</title>
                <screen># engine-image-uplaoder list
Please provide the REST API username for the admin@local oVirt Engine user:
**********
Export Storage Domain Name | Datacenter | Export Domain Status
myexportdom                | Myowndc    | active
                </screen>
                <para>上传镜像文件时，需要指定NFS共享目录（-n选项）或者Export存
                    储域（-e选项），以及需要上传的文件名：
                </para>
                <screen># engine-image-uploader -e myexportdom upload my.ovf
Please provide the REST API username for the admin@local oVirt Engine user:
**********
                </screen>
            </example>
        </section>
    </section>


    <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_4">
        <title>&OVIRT;ISO镜像上传工具</title>
        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_4_1">
            <title>关于ISO镜像上传工具</title>
            <para>&OVIRT;&MANAGER;中包含了ISO镜像上传工具，使用该工具上传ISO镜
                像。
            </para>
            <para>ISO上传工具的命令是engine-iso-uploader，必须在&OVIRT;&MANAGER;
                服务器上以root身份执行该命令。执行engine-iso-uploader -h可以查看
                命令的帮助信息。
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_4_2">
            <title>engine-iso-uploader命令行参数说明</title>
            <para>engine-iso-uploader的基本使用方法如下：
<screen>engine-iso-uploader [options] list
engine-image-uploader [options] upload [file].[file]...[file]
                </screen>
            </para>
            <para>2种操作模式：list和upload。
                <itemizedlist>
                    <listitem>
                        <para>list操作会列出&OVIRT;&MANAGER;中可用的ISO存储域。
                        </para>
                    </listitem>
                    <listitem>
                        <para>upload操作会上传ISO镜像文件（可以是多个，多个ISO镜
                            像文件之间使用空格分隔）到指定的ISO存储域。默认通过
                            NFS共享目录上传，也支持使用SSH上传。
                        </para>
                    </listitem>
                </itemizedlist>
                ISO镜像上传工具必须指定list或者upload其中一项操作，使用upload操
                作时，最少需要提供一个待上传镜像文件的路径。
            </para>
            <para>engine-iso-uploader提供了一些参数对命令的行为进行控制。
            </para>

            <simplesect>
                <title>通用命令行参数</title>
                <variablelist>
                    <varlistentry>
                        <term>--version</term>
                        <listitem>
                            <para>显示命令版本信息。</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-h，--help</term>
                        <listitem>
                            <para>显示命令帮助信息。</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--conf-file=配置文件路径</term>
                        <listitem>
                            <para>指定配置文件。</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--quiet</term>
                        <listitem>
                            <para>启用该选项之后,将命令的输出减少到最少。该选项
                                默认是不启用的。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-v，--verbose</term>
                        <listitem>
                            <para>启用该选项之后,命令将输出尽可能详细的信息。该
                                选项默认是不启用的。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-f，--force</term>
                        <listitem>
                            <para>当目标存储域中已经存在一个和将要上传的文件名字
                                相同，则必须使用强制模式。默认开启该选项。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>&OVIRT;&MANAGER;相关选项</title>
                <variablelist>
                    <varlistentry>
                        <term>-u 用户名，--user=用户名</term>
                        <listitem>
                            <para>指定上传文件时使用的用户名。用户名的格式为：
                                user@domain。同时用户必须在&OVIRT;&MANAGER;中已
                                经存在。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-r FQDN</term>
                        <listitem>
                            <para>指定目标&OVIRT;&MANAGER;服务器的FQDN域名。默认
                                是localhost，即运行该命令的服务器和
                                &OVIRT;&MANAGER;是同一台服务器。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>ISO存储域相关选项</title>
                <para>指定ISO镜像文件上传的目标ISO存储域，下面的2个选项互斥，不
                    能同时使用。
                </para>
                <variablelist>
                    <varlistentry>
                        <term>-i，--iso-domain=ISO存储域</term>
                        <listitem>
                            <para>指定ISO镜像文件上传的目标ISO存储域。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-n，--nfs-server=NFS共享目录</term>
                        <listitem>
                            <para>指定ISO镜像文件上传的目标NFS共享目录。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>连接相关选项</title>
                <para>ISO镜像上传工具默认使用NFS共享上传文件，使用下面的选项可以
                    切换为使用SSH连接上传。
                </para>
                <variablelist>
                    <varlistentry>
                        <term>--ssh-user=用户名</term>
                        <listitem>
                            <para>指定上传使用的SSH用户。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--ssh-port=SSH服务端口</term>
                        <listitem>
                            <para>指定远端服务器的SSH监听端口。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-k 公钥文件，--key-file=公钥文件</term>
                        <listitem>
                            <para>指定SSH连接的公钥文件。不使用公钥验证时，会提
                                示输入指定SSH用户的密码。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_4_3">
            <title>指定NFS共享目录上传ISO镜像文件示例</title>
            <example>
                <title>将ISO镜像文件上传到指定的NFS共享目录</title>
<screen># engine-iso-uploader --nfs-server=storage.demo.eayunos.com:/iso/path \
upload CentOS-6.5-x86_64.iso
                </screen>
            </example>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_4_4">
            <title>ISO镜像上传工具基本使用示例</title>
            <para>下面是ISO镜像上传工具的基本使用方法的示例。第一条命令列出了
                &OVIRT;&MANAGER;中可用的ISO存储域，使用的用户是admin@local。第二
                条命令通过NFS共享将ISO镜像文件上传到了指定的ISO存储域。
            </para>
            <example>
                <title>列出ISO存储域以及上传ISO镜像</title>
                <screen># engine-iso-uploader list
Please provide the REST API password for the admin@internal oVirt Engine user
(CTRL+D to abort): 
ISO Storage Domain Name   | Datacenter                | ISO Domain Status
ISO-DOMAIN                | Default                   | active
ISO_DOMAIN                | iscsi                     | active
ISO_DOMAIN                | local_datacenter          | active
                </screen>
                <screen># engine-iso-uploader --iso-domain=[ISODomain] upload \
[CentOS-6.5-x86_64.iso]
Please provide the REST API password for the admin@internal oVirt Engine user
(CTRL+D to abort):
                </screen>
            </example>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_4_5">
            <title>使用ISO镜像上传工具上传VirtIO</title>
            <para>下面的示例将virtio-win.iso、virtio-win.vfs上传ISODomain。
            </para>
            <screen># engine-iso-uploader --iso-domain=[ISODomain] upload \
/usr/share/virtio-win/virtio-win-0.1-74.iso \
/usr/share/virtio-win/virtio-win-drivers-20120712-1.vfd
            </screen>
        </section>
    </section>

    <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_5">
        <title>&OVIRT;日志收集工具</title>
        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_5_1">
            <title>关于日志收集工具</title>
            <para>&OVIRT;&MANAGER;提供了日志收集工具，在寻求技术支持时使用该工具
                可以更加快捷地收集相关的信息和日志。
            </para>
            <para>日志收集工具的命令是engine-log-collector，使用时需要使用root用
                户登录到&OVIRT;&MANAGER;服务器，并获得&MANAGER;的管理员访问权
                限。执行engine-log-collector -h可以查看命令的帮助说明。
            </para>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_5_2">
            <title>engine-log-collector命令行参数说明</title>
            <para>engine-log-collector的基本使用方法如下：
<screen>engine-log-collector [options] list [all, clusters, datacenters]
engine-image-uploader [options] collect
                </screen>
            </para>
            <para>2种操作模式：list和collect。
                <itemizedlist>
                    <listitem>
                        <para>list操作会列出&OVIRT;&MANAGER;中的数据中心、集群或
                            者主机。
                        </para>
                    </listitem>
                    <listitem>
                        <para>collect操作会从&OVIRT;&MANAGER;抓取相关的日志和信
                            息，并打包放置在/tmp/logcollector目录下。
                        </para>
                    </listitem>
                </itemizedlist>
                如果没有指定其他参数，默认的操作是自动收集当前&MANAGER;中所有数
                据中心、集群和主机相关的信息和日志，并打包。
            </para>
            <para>engine-log-collector提供了一些参数对命令的行为进行控制。
            </para>

            <simplesect>
                <title>通用命令行参数</title>
                <variablelist>
                    <varlistentry>
                        <term>--version</term>
                        <listitem>
                            <para>显示命令版本信息。</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-h，--help</term>
                        <listitem>
                            <para>显示命令帮助信息。</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--conf-file=配置文件路径</term>
                        <listitem>
                            <para>指定配置文件。</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--local-tmp=收集日志文件的存放路径</term>
                        <listitem>
                            <para>指定收集到的日志文件的存放路径。默认的路径是：
                                /tmp/logcollector。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--ticket-number=TICKET</term>
                        <listitem>
                            <para>指定ticket序号，主要用于区分生成的日志文件的名
                                称。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--upload=FTP服务器</term>
                        <listitem>
                            <para>日志收集完成之后上传到指定的FTP服务器。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--log-file=日志文件路径</term>
                        <listitem>
                            <para>指定记录命令输出的日志文件。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--quiet</term>
                        <listitem>
                            <para>启用该选项之后，将命令的输出减少到最少。该选项
                                默认是不启用的。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-v，--verbose</term>
                        <listitem>
                            <para>启用该选项之后，命令将输出尽可能详细的信息。该
                                选项默认是不启用的。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>&OVIRT;&MANAGER;相关选项</title>
                <para>下面这些选项可能指定访问&OVIRT;&MANAGER;时验证登录的方式、
                    选择需要收集的日志或者信息的类型、来源等。
                </para>
                <para>这些选项可以配合使用，如：engine-log-collector --user=
                    admin@local --cluster ClusterA,ClusterB --hosts
                    "SalesHost"*，将使用admin@local登录&MANAGER;，并收集
                    ClusterA和ClusterB这2个集群中所有SaleHost主机的日志和信息。
                </para>
                <variablelist>
                    <varlistentry>
                        <term>--no-hypervisors</term>
                        <listitem>
                            <para>不收机主机相关的日志和信息。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-u 用户，--user=用户</term>
                        <listitem>
                            <para>登录&MANAGER;时使用的用户。用户名的格式为：
                                user@domain。同时用户必须在&OVIRT;&MANAGER;中已
                                经存在。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-r FQDN</term>
                        <listitem>
                            <para>指定目标&OVIRT;&MANAGER;服务器的FQDN域名。默认
                                是localhost，即运行该命令的服务器和
                                &OVIRT;&MANAGER;是同一台服务器。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-c 集群，--cluster=集群</term>
                        <listitem>
                            <para>收集指定集群（可以是多个）相关的日志和信息。如
                                果指定多个集群，集群名之间使用“,”分隔。支持使用
                                通配符。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-d 数据中心，--datacenter=数据中心</term>
                        <listitem>
                            <para>收集指定数据中心（可以是多个）相关的日志和信
                                息。如果指定多个数据中心，数据中心名之间使用“,“
                                分隔。支持使用通配符。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-H 主机列表，--hosts=主机列表</term>
                        <listitem>
                            <para>收集指定主机（或者多个主机）相关的日志和信息。
                                多个主机使用“,”分割，可以使用主机名、ip地址，
                                fqdn域名，也支持使用通配符。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>SOS报表相关选项</title>
                <para>日志收集工具使用了JBoss SOS插件。使用下面的选项可以从JMX终
                    端收集信息。
                </para>
                <variablelist>
                    <varlistentry>
                        <term>--jboss-home=JBOSS_HOME</term>
                        <listitem>
                            <para>JBoss的安装目录，默认是/var/lib/jbossas。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--java-home=JAVA_HOME</term>
                        <listitem>
                            <para>Java的安装目录，默认是/usr/share/jvm/java。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--jboss-profile=JBOSS_PROFILE</term>
                        <listitem>
                            <para>指定日志收集使用的Jboss Profile配置。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--enable-jmx</term>
                        <listitem>
                            <para>从&OVIRT;&MANAGER;的JMX接口获取日志和信息。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--jboss-user=JBOSS_USER</term>
                        <listitem>
                            <para>调用JBoss JMX接口的用户，默认是admin。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--jboss-logsize=LOG_SIZE</term>
                        <listitem>
                            <para>最终生成的日志文件的最大体积（单位为MB）。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--jboss-stdjar=STATE</term>
                        <listitem>
                            <para>是否收集JBoss标准JAR状态信息。STATE可选的值为
                                on或者off，默认为on。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--jboss-servjar=STATE</term>
                        <listitem>
                            <para>是否收集所有服务配置目录下的JAR状态信息。STATE
                                可选的值为on或者off，默认为on。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--jboss-twiddle=STATE</term>
                        <listitem>
                            <para>是否收集twiddle数据。STATE可选的值为on或者
                                off，默认是on。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--jboss-appxml=XML_LIST</term>
                        <listitem>
                            <para>指定需要收集的应用的XML描述。默认为all。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>SSH相关选项</title>
                <variablelist>
                    <varlistentry>
                        <term>--ssh-port=端口</term>
                        <listitem>
                            <para>连接虚拟机时SSH服务的端口。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>-k 公钥文件，--key-file=公钥文件</term>
                        <listitem>
                            <para>指定通过SSH连接虚拟机时使用的公钥文件。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--max-connections=最大连接数</term>
                        <listitem>
                            <para>设置与虚拟机之间的SSH连接的MAX_CONNECTIONS参
                                数，默认为10。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>

            <simplesect>
                <title>PostgreSQL数据库相关选项</title>
                <para>如果更改了&OVIRT;&MANAGER;数据库名和数据库用户，则需要在执
                    行命令时通过参数指定数据库名和数据库用户。
                </para>
                <para>如果数据库不再本地，则需要通过pg-hostdb指定数据库所在的服
                    务器。要收集远程数据库服务器的日志，数据库需要安装SOS插件。
                </para>
                <variablelist>
                    <varlistentry>
                        <term>--no-postgresql</term>
                        <listitem>
                            <para>不收集数据库相关日志和信息。默认该选项没有开
                                启。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--pg-user=数据库用户</term>
                        <listitem>
                            <para>指定连接数据库使用的用户。默认为postgres。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--pg-dbname=数据库名</term>
                        <listitem>
                            <para>指定连接到数据库服务器要访问的数据库，默认为
                                engine。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--pg-dbhost=数据库服务器</term>
                        <listitem>
                            <para>指定数据库服务器。默认为localhost。
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>--pg-host-key=公钥文件</term>
                        <listitem>
                            <para>指定访问数据库时使用的公钥。当数据库服务器不在
                                本地时，需要使用该选项。
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </simplesect>
        </section>

        <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_5_3">
            <title>日志收集工具的使用示例</title>
            <para>不加任何参数执行engine-log-collector时会自动收集&OVIRT;
                &MANAGER;所有相关的日志和信息。数据库日志也默认收集，除非加上
                --no-postgresql选项。下面使用日志收集工具的示例：
                <screen># engine-log-collector
INFO: Gathering oVirt Engine information...
INFO: Gathering PostgreSQL the oVirt Engine database and log files from
localhost...
Please provide REST API password for the admin@internal oVirt Engine user
(CTRL+D to abort):
About to collect information from 3 hypervisors. Continue? (Y/n):
INFO: Gathering information from selected hypervisors...
INFO: collecting information from 192.168.122.250
INFO: collecting information from 192.168.122.251
INFO: collecting information from 192.168.122.252
INFO: finished collecting information from 192.168.122.250
INFO: finished collecting information from 192.168.122.251
INFO: finished collecting information from 192.168.122.252
Creating compressed archive...
INFO Log files have been collected and placed in /tmp/sosreport-LogCollector-20140428171306.tar.xz.
The MD5 for this file is be89822f20719d1094a39bc9ced3df49 and its size is 38.2M
                </screen>
            </para>
        </section>
    </section>

    <!-- TODO SPICE Proxy -->
    <!--
    <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_6">
        <title>SPICE代理</title>
        <para></para>
    </section>
    -->

    <!-- TODO Squid Proxy -->
    <!--
    <section id=
"sect-Installation_Guide-appendix-additional-utilites_Chapter_Section_7">
        <title>Squid代理</title>
        <para></para>
    </section>
    -->

</appendix>

