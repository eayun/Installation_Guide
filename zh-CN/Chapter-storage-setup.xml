<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Installation_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Installation_Guide-storage-setup">
	<title>存储配置</title>
	<section id="sect-Installation_Guide-storage-setup_Section_1">
		<title>流程图解之存储配置</title>
        <informalfigure>
            <mediaobject>
                <imageobject>
                    <imagedata
                        fileref="images/eayun_installation_checklist_storage_setup.png"
                        format="PNG" />
                </imageobject>
            </mediaobject>
        </informalfigure>
	</section>
	
	<section id="sect-Installation_Guide-storage-setup_Section_2">
		<title>关于&OVIRT;存储</title>
		<para>
            &OVIRT;虚拟化环境对虚拟机磁盘、ISO镜像以及虚拟机快照进行集中管理。存
            储系统支持的技术有：
			<itemizedlist>
				<listitem>
					<simpara>NFS（Network File System）
					</simpara>
				</listitem>
				<listitem>
					<simpara>GlusterFS
					</simpara>
				</listitem>
				<listitem>
					<simpara>其他兼容POSIX标准的文件系统
					</simpara>
				</listitem>
				<listitem>
					<simpara>iSCSI（Internet Small Computer System Interface）
					</simpara>
				</listitem>
				<listitem>
					<simpara>直接连接到&NODE;的本地存储设备
					</simpara>
				</listitem>
				<listitem>
					<simpara>光纤通道协议（FCP）
					</simpara>
				</listitem>
				<listitem>
					<simpara>并行NFS（pNFS）
					</simpara>
				</listitem>
			</itemizedlist>
            配置存储环境是使用新建数据中心的前提条件。数据中心只有在附加可用的存
            储域之后才能完成初始化。
		</para>
        <para>&OVIRT;虚拟化环境中对于存储的管理通过管理门户的“存储”标签完成。在
            “存储”标签可以看到当前所有存储域的列表，存储域的详细信息可以通过下方
            的详情面板获取。
        </para>
        <para>&OVIRT;虚拟化环境提供3种类型的存储域：
            <itemizedlist>
                <listitem>
                    <para><emphasis>Data域：</emphasis>Data域中保存的是供虚拟机使
                        用的磁盘和OVF（Open Virtualization Format）文件。虚拟机
                        的快照文件也保存在Data域中。
                    </para>
                    <para>Data域不可以在数据中心之间共享使用，而且Data域的存储类
                        型必须和数据中心保持一致，如：iSCSI类型的数据中心，必须
                        包含一个iSCSI类型的Data域。在数据中心中添加其他类型的另
                        外2种类型的存储域之前，数据中心必须已经包含了一个Data域。
                    </para>
                </listitem>
                <listitem>
                    <para><emphasis>ISO域：</emphasis>ISO域中保存光盘ISO镜像文件。
                        虚拟机使用这些光盘镜像安装操作系统或者其他应用软件。使用
                        ISO域省去了数据中心对于物理光驱和光盘等介质的需求。ISO域
                        可以在多个数据中心之间共享使用。
                    </para>
                </listitem>
                <listitem>
                    <para><emphasis>Export域：</emphasis>Export域的主要目的是提
                        供在数据中心或者&OVIRT;虚拟化环境之间拷贝和移动数据镜像
                        的临时存储空间。Export域也用于虚拟机的备份。Export域可以
                        在数据中心之间进行迁移，但是同一时间只能在一个数据中心中
                        激活。
                        <important>
                            <para>在以后的版本中逐步取消支持使用NFS以外的方式创
                                建Export域。建议新建的Export域都使用NFS存储方式。
                            </para>
                        </important>
                    </para>
                </listitem>
            </itemizedlist>
            在为数据中心添加存储域之前，请对于数据中心的存储需求进行评估和规划。
            <important>
                <para>要添加存储域，需要对管理门户的访问权限，同时数据中心至少应
                    该有一台已经启动的主机。
                </para>
            </important>
        </para>

        <formalpara>
            <title>参见：</title>
            <para><itemizedlist>
                    <listitem>
                        <simpara>
                            <xref linkend="sect-Installation_Guide-storage-setup_Section_3_1" />
                        </simpara>
                    </listitem>
                    <listitem>
                        <simpara>
                            <xref linkend="sect-Installation_Guide-storage-setup_Section_3_3" />
                        </simpara>
                    </listitem>
                    <listitem>
                        <simpara>
                            <xref linkend="sect-Installation_Guide-storage-setup_Section_3_4" />
                        </simpara>
                    </listitem>
                    <listitem>
                        <simpara>
                            <xref linkend="sect-Installation_Guide-storage-setup_Section_3_5" />
                        </simpara>
                    </listitem>
                    <listitem>
                        <simpara>
                            <xref linkend="sect-Installation_Guide-storage-setup_Section_3_6" />
                        </simpara>
                    </listitem>
                    <listitem>
                        <simpara>
                            <xref linkend="sect-Installation_Guide-storage-setup_Section_4" />
                        </simpara>
                    </listitem>
            </itemizedlist></para>
        </formalpara>
	</section>

	<section id="sect-Installation_Guide-storage-setup_Section_3">
		<title>为&OVIRT;添加存储</title>
        <section id="sect-Installation_Guide-storage-setup_Section_3_1">
            <title>添加NFS存储</title>
            <section id="sect-Installation_Guide-storage-setup_Section_3_1_1">
                <title>准备NFS存储</title>
                <simplesect>
                    <title>说明：</title>
                    <para>通过下面的步骤可以在&OVIRT;环境中建立NFS服务。
                    </para>
                    <procedure>
                        <title>准备NFS存储</title>
                        <step>
                            <title>安装nfs-utils</title>
                            <para>启用NFS服务需要安装nfs-utils软件包。
                                使用rpm命令检查系统是否已经安装：
                                <screen>$ rpm -qi nfs-utils
                                </screen>
                            </para>
                            <para>如果nfs-utils已经安装，软件包的信息会打印出来。
                                否则不会有任何输出，需要以root用户执行yum命令进行安
                                装：
                                <screen># yum install nfs-utils
                                </screen>
                            </para>
                        </step>
                        <step>
                            <title>配置服务启动</title>
                            <para>要保证主机可以操作时NFS服务处于可用状态，nfs和
                                rpcbind服务需要配置为开机自动启动。以root用户执
                                行chkconfig进行配置：
                                <screen># chkconfig --add rpcbind
# chkconfig --add nfs
# chkconfig rpcbind on
# chkconfig nfs on
                                </screen>
                            </para>
                            <para>配置服务开机自动启动之后，可以执行service立即
                                启动2个服务：
                                <screen># service rpcbind start
# service nfs start
                                </screen>
                            </para>
                        </step>
                        <step>
                            <title>创建共享目录</title>
                            <para>新建一个目录作为NFS共享目录：
                                <screen># mkdir /exports/iso
                                </screen>
                            </para>
                            <para>将示例中的/exports/iso替换为自己指定的共享目录。
                            </para>
                        </step>
                        <step>
                            <title>配置共享目录</title>
                            <para>NFS的共享目录在/etc/exports中进行配置。一个共
                                享目录对于配置文件中的一行，该行第一部分为共享目
                                录的路径，之后是一个tab字符，然后是NFS的共享参数。
                                要在&OVIRT;虚拟化环境使用NFS共享目录，该共享必须
                                提供读取和写入的权限。
                            </para>
                            <para>以/exports/iso为例，要配置为可读可写的NFS共享，
                                应该在/etc/exports中加入以下配置：
                                <screen>/exports/iso    *(rw)
                                </screen>
                            </para>
                            <para>同样在实际配置过程中，将上例中的/exports/iso替
                                换为自己指定的目录。
                            </para>
                        </step>
                        <step>
                            <title>更新NFS配置</title>
                            <para>更改/etc/exports配置之后，需要通知nfs服务重新
                                加载配置文件。以root用户执行以下命令强制重新加载
                                配置文件：
                                <screen># service nfs reload
                                </screen>
                            </para>
                        </step>
                        <step>
                            <title>配置权限</title>
                            <para>NFS共享目录的权限应该配置为：属主和属组分别为
                                vdsm和kvm。如果在NFS服务
                                器上没有上述用户和用户，则使用下面的命令配置属主
                                和属组（仍以/exports/iso为例）：
                                <screen># chown -R 36:36 /exports/iso
                                </screen>
                            </para>
                            <para>共享目录的权限应该配置为：属主和属组拥有读写和
                                写入的权限。属主还需要执行权限。权限设置使用chmod
                                命令。下面的命令以/exports/iso为例进行说明：
                                <screen># chmod 0755 /exports/iso
                                </screen>
                            </para>
                        </step>
                    </procedure>
                </simplesect>
                <simplesect>
                    <title>预期结果：</title>
                    <para>NFS共享目录准备就绪，可以添加到&OVIRT;虚拟化环境中。
                    </para>
                </simplesect>
            </section>

            <section id="sect-Installation_Guide-storage-setup_Section_3_1_2">
                <title>将NFS存储添加到数据中心</title>
                <simplesect>
                    <title>准备工作：</title>
                    <para>
                        <itemizedlist><listitem>
                                <simpara><xref
                                        linkend="sect-Installation_Guide-storage-setup_Section_3_1" />
                                </simpara>
                        </listitem></itemizedlist>
                    </para>
                </simplesect>
                <simplesect>
                    <title>说明：</title>
                    <para>NFS类型的存储域是附加到数据中心的NFS共享目录。NFS类型
                        的存储域可以用来保存虚拟机磁盘镜像或者ISO光盘镜像。NFS共
                        享目录准备好之后，要通过管理门户添加到数据中心。
                    </para>
                    <para>NFS类型的Data域可以添加到NFS类型的数据中心。NFS、ISO、
                        export存储可以添加到任意类型的数据中心。
                    </para>
                    <procedure>
                        <title>将NFS存储添加到数据中心</title>
                        <step>
                            <para>在管理门户中点击“存储”标签，显示当前的存储域列
                                表。
                            </para>
                        </step>
                        <step>
                            <para>点击“新建域”，打开“新建域”对话框。
                                <figure>
                                    <title>NFS存储</title>
                                    <mediaobject>
                                        <imageobject>
                                            <imagedata
                                                fileref="images/eayun_installation_storage_setup_add_nfs_storage.png"
                                                format="PNG" scalefit="1"
                                                width="100%" />
                                        </imageobject>
                                    </mediaobject>
                                </figure>
                            </para>
                        </step>
                        <step>
                            <para>填写域的“名称”。
                            </para>
                        </step>
                        <step>
                            <para>选择“数据中心”、“域功能/存储类型”、“使用主
                                机”。（如有必要，选择一种“格式”）
                            </para>
                        </step>
                        <step>
                            <para>填写“导出路径”，格式请输入框下方的说明。如：
                                192.168.0.1:/data或者server.example.com/data。
                            </para>
                        </step>
                        <step>
                            <para>点击“高级参数”，可以自行定义NFS共享的参数。建
                                议使用默认配置。
                                <important>
                                    <para>和存储域的通信都是通过指定的主机，而不
                                        是通过&MANAGER;。因此配置存储域之前要确
                                        保数据中心已经包含了一个可用的主机。
                                    </para>
                                </important>
                            </para>
                        </step>
                        <step>
                            <para>点击“确定”完成存储域的创建。
                            </para>
                        </step>
                    </procedure>
                </simplesect>
                <simplesect>
                    <title>预期结果：</title>
                    <para>新建的存储域在“存储”标签的列表中显示，初始化完成之前
                        状态为“Locked”，初始化完成之后会自动附加到数据中心。
                    </para>
                </simplesect>
            </section>
        </section>

        <section id="sect-Installation_Guide-storage-setup_Section_3_2">
            <title>添加pNFS存储</title>
            <section id="sect-Installation_Guide-storage-setup_Section_3_2_1">
                <title>准备pNFS存储</title>
                <!-- TODO: write document for deploying pNFS server -->
                <para>&OVIRT;虚拟化支持pNFS存储。pNFS改进了NFS的扩展性，同时在性
                    能方面也有一定提升。pNFS服务提供的共享目录，客户端可以同时通
                    过多台服务器进行访问。pNFS协议支持3种存储协议或者方案：
                    files、objects、blocks。&OVIRT;目前支持files方式。
                </para>
                <para>要使用pNFS，使用下面的参数挂载pNFS服务器提供的共享目录：
                    <screen> -o minorversion=1
                    </screen>
                    或者
                    <screen> -o v4.1
                    </screen>
                    配置共享目录的权限，使得&MANAGER;可以访问：
                    <screen># chown 36:36 [pNFS共享目录的路径]
                    </screen>
                </para>
                <para>服务器启动pNFS之后，nfs_layout_nfsv41_files内核模块会在第
                    一次挂载时自动加载。使用下面的命令确认模块是否已经正确加载：
                    <screen>$ lsmod | grep nfs_layout_nfsv41_files</screen>
                    另外一种确认的方法是执行mount命令，启用pNFS的挂载项会出现
                    minorversion=1的挂载参数。
                </para>
            </section>

            <section id="sect-Installation_Guide-storage-setup_Section_3_2_2">
                <title>将pNFS存储添加到数据中心</title>
                <simplesect>
                    <title>说明：</title>
                    <para>pNFS类型的存储域是附加到数据中心的pNFS共享目录。pNFS共
                        享目录准备好之后，要通过管理门户添加到数据中心。
                    </para>
                    <procedure>
                        <title>将pNFS存储添加到数据中心</title>
                        <step>
                            <para>在管理门户中点击“存储”标签，显示当前的存储域列
                                表。
                            </para>
                        </step>
                        <step>
                            <para>点击“新建域”，打开“新建域”对话框。
                                <figure>
                                    <title>pNFS存储</title>
                                    <mediaobject>
                                        <imageobject>
                                            <imagedata
                                                fileref="images/eayun_installation_storage_setup_add_pnfs_storage.png"
                                                format="PNG" scalefit="1"
                                                width="100%" />
                                        </imageobject>
                                    </mediaobject>
                                </figure>
                            </para>
                        </step>
                        <step>
                            <para>填写域的“名称”。
                            </para>
                        </step>
                        <step>
                            <para>选择“数据中心”、“域功能/存储类型”、“使用主
                                机”。（如有必要，选择一种“格式”）
                            </para>
                        </step>
                        <step>
                            <para>填写“路径”，格式如：192.168.0.1:/data或者
                                server.example.com/data。
                            </para>
                        </step>
                        <step>
                            <para>“VFS类型”，填写“nfs4”。</para>
                        </step>
                        <step>
                            <para>“挂载选项”，填写“minorversion=1”。
                                <important>
                                    <para>
                                        和存储域的通信都是通过指定的主机，而不是
                                        通过&MANAGER;。因此配置存储域之前要确保
                                        数据中心已经包含了一个可用的主机。
                                    </para>
                                </important>
                            </para>
                        </step>
                        <step>
                            <para>点击“确定”完成存储域的创建。
                            </para>
                        </step>
                    </procedure>
                </simplesect>
                <simplesect>
                    <title>预期结果：</title>
                    <para>新建的存储域在“存储”标签的列表中显示，初始化完成之前
                        状态为“Locked”，初始化完成之后会自动附加到数据中心。
                    </para>
                </simplesect>
            </section>
        </section>

        <section id="sect-Installation_Guide-storage-setup_Section_3_3">
            <title>添加iSCSI存储</title>
            <simplesect>
                <title>说明：</title>
                <para>&OVIRT;虚拟化平台支持在iSCSI存储提供的LUN卷组上建立存储
                    域。但是卷组或者LUN都不能同时加入到多个存储域。
                </para>
                <note><para>只能在iSCSI类型的数据中心里添加iSCSI存储域。
                </para></note>
                <procedure>
                    <title>将iSCSI存储添加到数据中心</title>
                    <step>
                        <para>在管理门户中点击“存储”标签，显示当前的存储域列
                            表。
                        </para>
                    </step>
                    <step>
                        <para>点击“新建域”，打开“新建域”对话框。
                            <figure>
                                <title>iSCSI存储</title>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="images/eayun_installation_storage_setup_add_iscsi_storage.png"
                                            format="PNG" scalefit="1"
                                            width="100%" />
                                    </imageobject>
                                </mediaobject>
                            </figure>
                        </para>
                    </step>
                    <step>
                        <para>填写域的“名称”。
                        </para>
                    </step>
                    <step>
                        <para>在“数据中心”中选择一个iSCSI类型的数据中心。
                        </para>
                        <para>如果没有可用的iSCSI的数据中心，选择“(none)”。</para>
                    </step>
                    <step>
                        <para>选择“域功能/存储类型”、“格式”。之前如果选中了一个
                            数据中心，则不兼容的“域功能/存储类型”在下拉列表中将
                            不会出现。
                        </para>
                    </step>
                    <step>
                        <para>选择“使用主机”。如果新建的存储域不是数据中心的第一
                            个存储域，则“使用主机”必须选择数据中心的SPM主机。
                        </para>
                        <important>
                            <para>
                                和存储域的通信都是通过指定的主机，而不是
                                通过&MANAGER;。因此配置存储域之前要确保
                                数据中心已经包含了一个可用的主机。
                            </para>
                        </important>
                    </step>
                    <step>
                        <para>&OVIRT;&MANAGER;支持iSCSI target到LUN的映射，也支
                            持LUN到iSCSI target的映射。在“新建域”对话框中，选择
                            iSCSI存储类型之后，会自动显示已知的iSCSI target及其
                            上配置的LUN。如果准备添加的iSCSI target没有自动列
                            出，可以点击“发现目标”进行扫描，否则可以直接进入下一
                            步。
                        </para>
                        <highlights>
                            <simpara>发现iSCSI目标</simpara>
                        </highlights>
                        <substeps>
                            <step>
                                <para>点击“发现目标”。当iSCSI target已经被发现并
                                    登录之后，“新建域”对话框会自动列出target中没
                                    有使用的LUN。
                                </para>
                                <note>
                                    <para>在&OVIRT;&MANAGER;之外被使用的LUN仍然
                                        会列出。
                                    </para>
                                </note>
                                <para>通过“发现目标”可以添加来自多个target的
                                    LUN，也可以添加同一个LUN的多个路径。
                                </para>
                            </step>
                            <step>
                                <para>在“地址”的输入栏中填入iSCSI target的fqdn
                                    域名或者ip地址。
                                </para>
                            </step>
                            <step>
                                <para>在“端口”的输入栏中填入iSCSI target的端口，
                                    默认为3260。
                                </para>
                            </step>
                            <step>
                                <para>如果iSCSI存储使用了CHAP（Challenge
                                    Handshake Authentication）加密认证协议，则需
                                    要选中“用户验证”，并填写“CHAP用户”和“CHAP密
                                    码”。
                                </para>
                            </step>
                            <step>
                                <para>点击”发现“按钮。
                                </para>
                            </step>
                            <step>
                                <para>从发现目录的结果的选择要进行添加的target，
                                    点击登录按钮（图标为向右的箭头）。也是点击上
                                    方的“登录全部”按钮登录所有发现的target。
                                </para>
                            </step>
                        </substeps>
                    </step>
                    <step>
                        <para>点击target前面的“+”按钮，在target下方会列出所有未
                            被使用的LUN列表。
                        </para>
                    </step>
                    <step>
                        <para>勾选准备在其上建立存储域的LUN。
                        </para>
                    </step>
                    <step>
                        <para>点击“确定”完成存储域的创建。
                        </para>
                    </step>
                </procedure>
            </simplesect>
            <simplesect>
                <title>预期结果：</title>
                <para>新建的iSCSI存储域在“存储”标签的列表中显示，初始化过程需要
                    5分钟左右。
                </para>
            </simplesect>
        </section>

        <section id="sect-Installation_Guide-storage-setup_Section_3_4">
            <title>添加FCP存储</title>
            <simplesect>
                <title>说明：</title>
                <para>&OVIRT;虚拟化平台支持在SAN存储网络提供的LUN卷组上建立存储
                    域。但是卷组或者LUN都不能同时加入到多个存储域。
                </para>
                <para>&OVIRT;虚拟化平台的管理人员对SAN（Stroage Area Network）存
                    储网络有一定了解。通常情况下，SAN存储网络中服务器主机和共享
                    的存储设备之间通过FCP（Fibre Channel Protocol）进行通信。因
                    此FCP存储多用于将SAN存储网络中的存储设备添加为数据中心的存储
                    域。
                </para>
                <note><para>
                        只能将FCP存储域添加到FCP类型的数据中心。
                </para></note>
                <procedure>
                    <title>将FCP存储添加到数据中心</title>
                    <step>
                        <para>在管理门户中点击“存储”标签，显示当前的存储域列
                            表。
                        </para>
                    </step>
                    <step>
                        <para>点击“新建域”，打开“新建域”对话框。
                            <figure>
                                <title>FCP存储</title>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="images/eayun_installation_storage_setup_add_fcp_storage.png"
                                            format="PNG" scalefit="1"
                                            width="100%" />
                                    </imageobject>
                                </mediaobject>
                            </figure>
                        </para>
                    </step>
                    <step>
                        <para>填写域的“名称”。
                        </para>
                    </step>
                    <step>
                        <para>在“数据中心”中选择一个iSCSI类型的数据中心。
                        </para>
                        <para>如果没有可用的iSCSI的数据中心，选择“(none)”。</para>
                    </step>
                    <step>
                        <para>选择“域功能/存储类型”、“格式”。之前如果选中了一个
                            数据中心，则不兼容的“域功能/存储类型”在下拉列表中将
                            不会出现。
                        </para>
                    </step>
                    <step>
                        <para>选择“使用主机”。如果新建的存储域不是数据中心的第一
                            个存储域，则“使用主机”必须选择数据中心的SPM主机。
                        </para>
                        <important>
                            <para>
                                和存储域的通信都是通过指定的主机，而不是
                                通过&MANAGER;。因此配置存储域之前要确保
                                数据中心已经包含了一个可用的主机。
                            </para>
                        </important>
                    </step>
                    <step>
                        <para>在“域功能/存储类型”中选中“Data/Fibre Channel”之
                            后，连接到主机的FCP存储设备上没有使用的LUN会自动显示
                            在列表中。选择“Lun ID”前面的复选框选中所有可用的
                            LUN。
                        </para>
                    </step>
                    <step>
                        <para>点击“确定”完成存储域的创建。
                        </para>
                    </step>
                </procedure>
            </simplesect>
            <simplesect>
                <title>预期结果：</title>
                <para>新建的FCP存储域在“存储”标签的列表中显示，初始化完成之前
                    状态为“Locked”，初始化完成之后会自动附加到数据中心。
                </para>
            </simplesect>
        </section>

        <section id="sect-Installation_Guide-storage-setup_Section_3_5">
            <title>添加本地存储</title>
            <section id="sect-Installation_Guide-storage-setup_Section3_5_1">
                <title>准备本地存储</title>
                <simplesect>
                    <title>说明：</title>
                    <para>在数据中心的主机上可以建立本地存储域。本地存储建立之
                        后，主机会自动加入一个新建的数据中心和一个新建的集群，该
                        数据中心和集群无法加入其他主机。一般的集群包含多个主机，
                        所有主机都可以 使用集群中任何一个存储域，这对于本地存储
                        域是不可实现的。这种单主机的集群，也可以创建虚拟机，但是
                        虚拟机无法迁移、调度和隔离。
                    </para>
                    <important>
                        <para>在&OVIRT;&NODE;中，/data/images目录是唯一可以作为
                            本地存储域的路径，因为该目录的权限和属主属组配置都已
                            经符合要求。下文中“准备本地存储”的步骤是只针对其他安
                            装通用Linux系统服务器。
                        </para>
                    </important>
                    <procedure>
                        <title>准备本地存储</title>
                        <step>
                            <para>在&NODE;上新建用来创建本地存储域的目录：
                                <screen># mkdir -p /data/images
                                </screen>
                            </para>
                        </step>
                        <step>
                            <para>确保vdsm用户（uid为36）和kvm用户组（gid为36）
                                对本地存储目录有读取和写入权限。
                                <screen># chown 36:36 /data/ /data/images
                                </screen>
                                <screen># chmod 0755 /data/ /data/images
                                </screen>
                            </para>
                        </step>
                    </procedure>
                </simplesect>
                <simplesect>
                    <title>预期结果：</title>
                    <para>新建本地存储域加入到了&OVIRT;虚拟化环境。
                    </para>
                </simplesect>
            </section>

            <section id="sect-Installation_Guide-storage-setup_Section3_5_2">
                <title>创建本地存储域</title>
                <simplesect>
                    <title>说明：</title>
                    <para>本地存储目录准备就绪之后，可以在对应的主机上建立本地存
                        储。
                    </para>
                    <para>在主机上创建本地存储域会新建一个数据中心和一个集群。新
                        的本地存储域和新数据中心、新集群是在一次操作中完成的。
                    </para>
                    <procedure>
                        <title>创建本地存储域</title>
                        <step>
                            <para>在管理门户中点击“主机”标签，显示当前的主机列表。
                            </para>
                        </step>
                        <step>
                            <para>点击“维护”，将主机设置为维护模式。
                            </para>
                        </step>
                        <step>
                            <para>点击“配置本地存储”，打开“配置本地存储”对话框。
                                <figure>
                                    <title>配置本地存储</title>
                                    <mediaobject>
                                        <imageobject>
                                            <imagedata
                                                fileref="images/eayun_installation_storage_setup_configure_local_storage.png"
                                                format="PNG" scalefit="1"
                                                width="100%" />
                                        </imageobject>
                                    </mediaobject>
                                </figure>
                            </para>
                        </step>
                        <step>
                            <para>点击“数据中心”、“集群”、“存储”后面的“编辑”可以
                                对前述3项内容进行修改。
                            </para>
                        </step>
                        <step>
                            <para>填入本地存储的路径。
                            </para>
                        </step>
                        <step>
                            <para>如果有优化需求，点击“优化”标签，配置“内存优
                                化”和“CPU线程”策略。
                            </para>
                        </step>
                        <step>
                            <para>点击“确定”完成存储域的创建。
                            </para>
                        </step>
                    </procedure>
                </simplesect>
                <simplesect>
                    <title>预期结果：</title>
                    <para>主机加入到新建的数据中心，并显示为在线状态。
                    </para>
                </simplesect>
            </section>
        </section>

        <section id="sect-Installation_Guide-storage-setup_Section_3_6">
            <title>添加兼容POSIX标准的文件系统作为存储域</title>
            <section id="sect-Installation_Guide-storage-setup_Section_3_6_1">
                <title>关于兼容POSIX标准的文件系统作为存储域</title>
                <para>&OVIRT;虚拟化环境中支持兼容POSIX标准的文件系统作为存储域。
                    创建兼容POSIX标准的文件系统作为存储域，支持使用自定义的参数
                    挂载文件系统，和手工挂载文件系统类似。这种类型的存储域主要用
                    于除了NFS、iSCSI、FCP之外的存储。
                </para>
                <para>&OVIRT;虚拟化环境中使用的兼容POSIX标准的文件系统必须支持
                    sparse文件和直接I/O。如CIFS（Common Internet File System）不
                    支持直接I/O，所以无法在&OVIRT;虚拟化环境中使用。
                </para>
                <important>
                    <para>不要使用兼容POSIX标准的文件系统存储域挂载NFS共享。NFS
                        共享应该都使用NFS存储域。
                    </para>
                </important>
            </section>

            <section id="sect-Installation_Guide-storage-setup_Section_3_6_2">
                <title>添加兼容POSIX标准的文件系统作为存储域</title>
                <simplesect>
                    <title>说明：</title>
                    <para>使用兼容POSIX标准的文件系统在除了NFS、iSCSI、FCP等类型
                        之外的存储上创建存储域。
                    </para>
                    <procedure>
                        <title>添加兼容POSIX标准的文件系统作为存储域</title>
                        <step>
                            <para>在管理门户中点击“存储”标签，显示当前的存储域列
                                表。
                            </para>
                        </step>
                        <step>
                            <para>点击“新建域”，打开“新建域”对话框。
                                <figure>
                                    <title>POSIXFS存储</title>
                                    <mediaobject>
                                        <imageobject>
                                            <imagedata
                                                fileref="images/eayun_installation_storage_setup_add_posixfs_storage.png"
                                                format="PNG" scalefit="1"
                                                width="100%" />
                                        </imageobject>
                                    </mediaobject>
                                </figure>
                            </para>
                        </step>
                        <step>
                            <para>填写域的“名称”。
                            </para>
                        </step>
                        <step>
                            <para>在“数据中心”中选择一个POSIX compliant FS类型的
                                数据中心。
                            </para>
                            <para>如果没有可用的数据中心，选择“(none)”。</para>
                        </step>
                        <step>
                            <para>在“域功能/存储类型”中选中
                                “Data / POSIX compliant FS”。
                            </para>
                            <para>如有必要，选择一种“格式”。
                            </para>
                        </step>
                        <step>
                            <para>选择“使用主机”。下拉框中只有当前数据中心中的主
                                机可选。选中的主机将会连接到新建的存储域。
                            </para>
                        </step>
                        <step>
                            <para>填写“路径”，和手工执行mount命令中使用的路径相
                                同。
                            </para>
                        </step>
                        <step>
                            <para>填写“VFS类型”，和手动执行mount命令时-t选项之后
                                的值相同。
                            </para>
                        </step>
                        <step>
                            <para>填写“挂载选项”，和手动执行mount命令时-o选项之
                                后的值相同，不同的参数使用“,”分隔。
                            </para>
                        </step>
                        <step>
                            <para>点击“确定”完成存储域的创建。
                            </para>
                        </step>
                    </procedure>
                </simplesect>
                <simplesect>
                    <title>预期结果：</title>
                    <para>通过POSIXFS存储域将其他类型的存储附加到数据中心。
                    </para>
                </simplesect>
            </section>
        </section>
	</section>

	<section id="sect-Installation_Guide-storage-setup_Section_4">
		<title>ISO域</title>
		<para>
			This is a test paragraph in a section
		</para>
	</section>
</chapter>

