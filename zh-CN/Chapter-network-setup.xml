<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Installation_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Installation_Guide-network-setup">
	<title>配置网络</title>
    <section id="sect-Installation_Guide-network-setup_Section_1">
		<title>流程图解之规划数据中心</title>
        <informalfigure>
            <mediaobject>
                <imageobject>
                    <imagedata
                        fileref="images/eayun_installation_checklist_network_setup.png"
                        format="PNG" />
                </imageobject>
            </mediaobject>
        </informalfigure>
	</section>

	<section id="sect-Installation_Guide-network-setup_Section_2">
		<title>&OVIRT;网络</title>
        <para>&OVIRT;虚拟化使用网络完成绝大多数的管理、维护操作。存储、&NODE;管
            理、用户访问、虚拟机的网络连接等都依赖于设计良好的网络结构。配置网络
            是&OVIRT;虚拟化环境部署的前提条件，原因是根据已有的网络需求来配置网
            络，比在实际使用过程逐步调整和修改网络配置更简单。
		</para>
        <para>不过也可以在没有网络规划的情况部署&OVIRT;虚拟化，只需要确保所有的
            &NODE;都只要配备了一块以太网卡。但是这种情况下部署的虚拟化环境不是最
            优化的方案。不同的应用事务和场景对网络结构的要求不同，按照功能或者相
            关性将整个环境划分为不同的网络，可以提供网络的性能和效率，也可以减低
            排错的难度。
        </para>
        <para>&OVIRT;虚拟化使用逻辑网络来实现网络的划分。逻辑网络定义了物理网络
            中特定类型网络通信的传输路径，实现了网络通信的隔离和物理网络的虚拟化。
        </para>
        <para>&OVIRT;虚拟化自动建立了ovirtmgmt的逻辑网络，&MANAGER;和&NODE;之间
            通过该逻辑网络进行通信。可以自行定义其他的逻辑网络分隔以下网络通信：
            <itemizedlist>
                <listitem><simpara>
                        与显示相关的网络通信。
                </simpara></listitem>
                <listitem><simpara>
                        虚拟机自身的网络通信。
                </simpara></listitem>
                <listitem><simpara>
                        存储设备相关的网络通信。
                </simpara></listitem>
            </itemizedlist>
            为了实现最优的网络性能，建议将上述网络通信分离，创建相应的逻辑网络。
            逻辑网络可以由物理网络设备（如以太网卡）或者逻辑网络设备（如bonding
            网卡）组成。使用虚拟局域网（VLAN）技术可以实现单一物理网络设备隔离网
            络通信，使得多个逻辑网络可以共享使用同一个逻辑网络。要使用VLAN技术，
            物理网络中的交换机需要满足对VLAN标记支持。
        </para>
        <para>&OVIRT;虚拟化环境中逻辑网络数量上的限制是：
            <itemizedlist>
                <listitem>
                    <para>附加到&NODE;的逻辑网络的上限是可用网络的数量乘以VLAN网
                        络设备的上限（4096）。
                    </para>
                </listitem>
                <listitem>
                    <para>整个集群逻辑网络的上限和可以附加到一个&NODE;的逻辑网络
                        的数量相同，因为集群中所有的&NODE;应该共享相同的网络结构。
                    </para>
                </listitem>
                <listitem>
                    <para>整个数据中心逻辑网络的上限是集群的数量乘以每个集群中逻
                        辑网络数量的上限。
                    </para>
                </listitem>
            </itemizedlist>
        </para>
        <note>
            <para>建议在规划和配置&OVIRT;虚拟化环境的网络时，对于相关网络技术的
                概念和使用有较深入的了解。对于具体网络设备的配置和操作，请阅读官
                方手册，或寻求厂商技术支持。
            </para>
        </note>
        <important>
            <para>请谨慎修改ovirtmgmt网络的配置。错误的配置可能导致&NODE;出现暂
                时无法管理的情况。
            </para>
        </important>
        <important>
            <para>如果在&OVIRT;虚拟机节点提供任何服务,一旦&OVIRT;虚拟化环境停止
                工作，则所有的服务都会停止工作，下面这些可能需要特别考虑：
                <itemizedlist>
                    <listitem>
                        <simpara>目录服务</simpara>
                    </listitem>
                    <listitem>
                        <simpara>DNS服务</simpara>
                    </listitem>
                    <listitem>
                        <simpara>存储设备</simpara>
                    </listitem>
                </itemizedlist>
            </para>
        </important>
        <formalpara>
            <title>参见：</title>
            <para><itemizedlist>
                    <listitem><simpara>
                            <!--
                            <link linkend=
                                "sect-Installation_Guide-network-setup_Section_3">
                                9.3 逻辑网络
                            </link>
                            -->
                            <xref
                                linkend="sect-Installation_Guide-network-setup_Section_3" />
                    </simpara></listitem>
                    <listitem><simpara>
                            <!--
                            <link linkend=
                                "sect-Installation_Guide-network-setup_Section_5">
                                9.5 网卡绑定
                            </link>
                            -->
                            <xref
                                linkend="sect-Installation_Guide-network-setup_Section_5" />
                    </simpara></listitem>
            </itemizedlist></para>
        </formalpara>
    </section>

	<section id="sect-Installation_Guide-network-setup_Section_3">
		<title>逻辑网络</title>
        <section id="sect-Installation_Guide-network-setup_Section_3_1">
            <title>创建新的逻辑网络</title>
            <simplesect>
                <title>说明：</title>
                <para>在数据中心或者集群中创建新的逻辑网络。
                </para>
                <procedure>
                    <title>创建新的数据中心</title>
                    <step><para>
                            进入数据中心或者集群列表，选中要建立逻辑网络的对象。
                    </para></step>
                    <step><para>
                            在下方的详情面板中选择“虚拟网络”，可以看到已有逻辑网
                            络的列表。
                    </para></step>
                    <step><para>
                            对于数据中心，点击“新建”，打开“新建逻辑网络”对话框；
                            对于集群，点击“添加网络”，打开“新建逻辑网络”对话框。
                            <figure>
                                <title>新建逻辑网络</title>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="images/eayun_installation_network_setup_new_logic_network.png"
                                            format="PNG" />
                                    </imageobject>
                                </mediaobject>
                            </figure>
                    </para></step>
                    <step><para>
                            填写逻辑网络的“名称”和“描述”。
                    </para></step>
                    <step><para>
                            选择是否使用”导出“到其他的虚拟化平台、“启用VLAN标
                            签”、“虚拟机网络”和“覆盖MTU”。
                    </para></step>
                    <step><para>
                            点击”集群“标签，选择该逻辑网络附加到哪一个集群，同时
                            也可以配置是否是集群的必需网络。
                    </para></step>
                    <step><para>
                            点击”配置集“标签，根据需要将虚拟网络配置以及QoS配置。
                    </para></step>
                    <step><para>
                            点击“确定”创建逻辑网络。
                    </para></step>
                </procedure>
            </simplesect>
            <simplesect>
                <title>预期结果：</title>
                <para>为集群或者数据中心中所有的集群创建了新的逻辑网络，可以将它
                    附加到集群中的&NODE;。
                </para>
                <formalpara>
                    <title>参见：</title>
                    <para><itemizedlist>
                            <listitem><simpara>
                                    <!--
                                    <link linkend=
                                        "sect-Installation_Guide-planning-data-center-setup_Section_3_1">
                                        8.3.1 &OVIRT;虚拟化环境中的数据中心
                                    </link>
                                    -->
                                    <xref linkend=
                                        "sect-Installation_Guide-planning-data-center-setup_Section_3_1" />
                            </simpara></listitem>
                            <listitem><simpara>
                                    <!--
                                    <link linkend=
                                        "sect-Installation_Guide-planning-data-center-setup_Section_4_1">
                                        8.4.1 &OVIRT;虚拟化环境中的集群
                                    </link>
                                    -->
                                    <xref linkend=
                                        "sect-Installation_Guide-planning-data-center-setup_Section_4_1" />
                            </simpara></listitem>
                    </itemizedlist></para>
                </formalpara>
            </simplesect>
        </section>

        <section id="sect-Installation_Guide-network-setup_Section_3_2">
            <title>配置主机网卡以及附加逻辑网络</title>
            <simplesect>
                <title>说明：</title>
                <para>在&OVIRT;&MANAGER;中可以对&NODE;的网络进行配置。将默认的
                    逻辑网络ovirtmgmt附加到不同的网卡，并将新创建的逻辑网络附加
                    到&NODE;的网卡。这些都是配置&NODE;网络的常规操作。
                </para>
                <procedure>
                    <title>配置主机网卡以及附加逻辑网络</title>
                    <step><para>
                            进入主机列表，选中要进行配置的主机。
                    </para></step>
                    <step><para>
                            在下方的详情面板中选择“网络接口”，可以看到该主机的网
                            卡列表及相关配置。
                    </para></step>
                    <step><para>
                            点击“设立主机网络”，打开“设立主机网络”对话框。
                            <figure>
                                <title>设立主机网络</title>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="images/eayun_installation_network_setup_host_networks.png"
                                            format="PNG" width="100%" scalefit="1" />
                                    </imageobject>
                                </mediaobject>
                            </figure>
                    </para></step>
                    <step>
                        <para>从“未分配的逻辑网络”中选中其中一个逻辑网络，拖动到
                            网卡对应的“分配的逻辑网络”区域，即可将该逻辑网络附加
                            到网卡上。
                        </para>
                        <para>也可以在“未分配的逻辑网络”中选中其中一个逻辑网络，
                            点击右键，选择相应网卡完成附加操作。
                        </para>
                    </step>
                    <step>
                        <para>要修改逻辑网络的配置，首先将鼠标移动到“分配的逻辑
                            网络”中对应的逻辑网络之上，点击出现的铅笔形状的图标
                            即可打开“编辑管理网络”对话框。
                        </para>
                        <para>如果逻辑网络的配置没有自动和&NODE;已经的配置同步，
                            可以首先选中“同步网络”。
                        </para>
                        <para>选择“引导协议”：
                            <itemizedlist>
                                <listitem><simpara>None
                                </simpara></listitem>
                                <listitem><simpara>DHCP
                                </simpara></listitem>
                                <listitem><simpara>Static
                                </simpara></listitem>
                            </itemizedlist>
                            如果选择“Static”，需要填写“IP”、“子网掩码”和“网关”。
                        </para>
                        <para>点击“确定”。</para>
                    </step>
                    <step><para>
                            选中“检验主机和ovirt-engine间的连接性”可以检查网络配
                            置的修改是否会影响&MANAGER;和&NODE;之间的网络连接。
                            检查只在主机处于“维护模式”时可以进行。
                    </para></step>
                    <step><para>
                            要确保整个虚拟化环境重启之后，配置依然有效，选中
                            “保存网络配置”。
                    </para></step>
                    <step><para>
                            点击“确定”完成主机网络配置的修改。
                    </para></step>
                </procedure>
            </simplesect>
            <simplesect>
                <title>预期结果：</title>
                <para>将逻辑网络附加到主机的网卡，并完成了网络配置的修改。
                </para>
                <note><para>如果主机的网卡没有完全显示在”网络接口“列表中，可以点
                        击上方主面板中的”刷新能力“重新获取。
                </para></note>
            </simplesect>
        </section>

        <section id="sect-Installation_Guide-network-setup_Section_3_3">
            <title>逻辑网络配置说明</title>
            <figure>
                <title>逻辑网络配置</title>
                <mediaobject>
                    <imageobject>
                        <imagedata
                            fileref="images/eayun_installation_network_setup_new_logic_network.png"
                            format="PNG" />
                    </imageobject>
                </mediaobject>
            </figure>
            <para>下表对逻辑网络的配置项进行说明：
                <table>
                    <title>新建逻辑网络配置项</title>
                    <tgroup cols="2">
                        <thead><row>
                                <entry>配置项</entry>
                                <entry>说明</entry>
                        </row></thead>
                        <tbody>
                            <row>
                                <entry>名称</entry>
                                <entry><simpara>
                                        逻辑网络的名称，长度最大为15个字符，必须
                                        是由大小写字母、数组、“-”和“_”组成的集群
                                        内唯一标识。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>描述</entry>
                                <entry><simpara>
                                        逻辑网络的描述，长度不能超过40个字符。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>注释</entry>
                                <entry><simpara>
                                        针对逻辑网络额外的可读性较好的说明。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>在外部供应商创建</entry>
                                <entry>
                                    <simpara>
                                        允许通过OpenStack的网络服务建立逻辑网络。
                                    </simpara>
                                    <simpara>
                                        <emphasis>外部供应商</emphasis>——可以在
                                        其上建立逻辑网络的外部网络服务。
                                    </simpara>
                                </entry>
                            </row>
                            <row>
                                <entry>启动VLAN标签</entry>
                                <entry><simpara>
                                        VLAN标签是一种安全特性，逻辑网络的网络通
                                        信都会加上该标签，其他没有相同标签的逻辑
                                        网络无法读取这些网络通信数据。使用这一特
                                        性，可以将多个逻辑网络（VLAN标签不同）附
                                        加到同一块物理网卡。VLAN标签以数字的形式
                                        表示。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>虚拟机网络</entry>
                                <entry><simpara>
                                        如果只有虚拟机使用该逻辑网络，可以选中该
                                        项。如果逻辑网络也附加到了其他设备（如存
                                        储设备等），则不能选中该项。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>覆盖MTU</entry>
                                <entry><simpara>
                                    自行设置逻辑网络的MTU值。
                                </simpara></entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>
        </section>

        <section id="sect-Installation_Guide-network-setup_Section_3_4">
            <title>逻辑网络配置</title>
            <simplesect>
                <title>说明：</title>
                <para>对逻辑网络进行配置。
                </para>
                <procedure>
                    <title>逻辑网络配置</title>
                    <step><para>
                            进入数据中心列表，选中要进行配置的数据中心。
                    </para></step>
                    <step><para>
                            在下方的详情面板中选择“逻辑网络”，可以看到该数据中心
                            所有已定义的逻辑网络。
                    </para></step>
                    <step><para>
                            选择逻辑网络，点击“编辑”，打开“编辑逻辑网络”对话框。
                    </para></step>
                    <step>
                        <para>根据需要调整逻辑网络的配置。
                        </para>
                    </step>
                    <step>
                        <para>点击“确定”保存修改。</para>
                    </step>
                </procedure>
            </simplesect>
            <simplesect>
                <title>预期结果：</title>
                <para>逻辑网络的配置更新。
                </para>
                <formalpara>
                    <title>参见：</title>
                    <para><itemizedlist>
                            <listitem><simpara>
                                    <xref
                                        linkend="sect-Installation_Guide-network-setup_Section_3_3" />
                            </simpara></listitem>
                        </itemizedlist>
                    </para>
                </formalpara>
            </simplesect>
        </section>

        <section id="sect-Installation_Guide-network-setup_Section_3_5">
            <title>管理逻辑网络的分配</title>
            <simplesect>
                <title>准备工作：</title>
                <para>
                    <itemizedlist><listitem>
                            <simpara><xref
                                    linkend="sect-Installation_Guide-network-setup_Section_3_1" />
                            </simpara>
                    </listitem></itemizedlist>
                </para>
            </simplesect>
            <simplesect>
                <title>说明：</title>
                <para>将逻辑网络分配或者取消分配到集群。</para>
                <procedure>
                    <title>将逻辑网络分配获取取消分配到集群</title>
                    <step>
                        <para>进入集群列表，选中需要进行配置的集群。</para>
                    </step>
                    <step>
                        <para>点击详情面板中的“逻辑网络”，可以看到逻辑网络的列表。
                        </para>
                    </step>
                    <step>
                        <para>点击“管理网络”，打开“管理网络”对话框。</para>
                        <figure>
                            <title>管理网络</title>
                            <mediaobject>
                                <imageobject>
                                    <imagedata
                                        fileref="images/eayun_installation_network_setup_manage_networks.png"
                                        format="PNG" scalefit="1" width="100%" />
                                </imageobject>
                            </mediaobject>
                        </figure>
                    </step>
                    <step>
                        <para>根据实际情况，选中或者取消选中“分配所有”、“所有必
                            需的”、“虚拟机网络”、“显示网络”、“迁移网络”。
                        </para>
                    </step>
                    <step>
                        <para>点击“确定”完成逻辑网路的配置更改。
                        </para>
                    </step>
                </procedure>
            </simplesect>
            <simplesect>
                <title>预期结果：</title>
                <para>完成逻辑网络的配置。</para>
                <note>
                    <para>建立在外部供应商之上的逻辑网络无法设置为“显示网络”。
                    </para>
                </note>
                <formalpara>
                    <title>参见：</title>
                    <para><itemizedlist>
                            <listitem><simpara>
                                    <xref
                                        linkend="sect-Installation_Guide-network-setup_Section_3_2" />
                            </simpara></listitem>
                            <listitem><simpara>
                                    <xref
                                        linkend="sect-Installation_Guide-network-setup_Section_3_6" />
                            </simpara></listitem>
                        </itemizedlist>
                    </para>
                </formalpara>
            </simplesect>
        </section>

        <section id="sect-Installation_Guide-network-setup_Section_3_6">
            <title>管理网络中配置项的说明</title>
            <para>下表对逻辑网络的配置项进行说明：
                <table>
                    <title>管理网络配置项</title>
                    <tgroup cols="2">
                        <thead><row>
                                <entry>配置项</entry>
                                <entry>说明</entry>
                        </row></thead>
                        <tbody>
                            <row>
                                <entry>分配所有</entry>
                                <entry><simpara>
                                        将逻辑网络分配到集群中所有的主机。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>所有必需的</entry>
                                <entry><simpara>
                                        只有当逻辑网络在所有的主机上都附加到一个
                                        可用的网卡之后才可以正常工作。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>虚拟机网络</entry>
                                <entry><simpara>
                                        该逻辑网络中只有虚拟机的网络通信。
                                </simpara></entry>
                            </row>
                            <row>
                                <entry>显示网络</entry>
                                <entry>
                                    <simpara>
                                        该逻辑网络中只有客户端通过SPICE连接虚拟
                                        机显示的网络通信。
                                    </simpara>
                               </entry>
                            </row>
                            <row>
                                <entry>迁移网络</entry>
                                <entry><simpara>
                                        该逻辑网络中只有虚拟机和存储域迁移时的网
                                        络通信。  
                                </simpara></entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>
        </section>
	</section>

	<section id="sect-Installation_Guide-network-setup_Section_4">
		<title>使用管理界面的网络页</title>
		<para>
			This is a test paragraph in a section
		</para>
	</section>

	<section id="sect-Installation_Guide-network-setup_Section_5">
		<title>网卡绑定</title>
		<para>
			This is a test paragraph in a section
		</para>
	</section>
</chapter>

